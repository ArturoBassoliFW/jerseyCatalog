{% extends "base.html" %}

{% block title %}{{ titolo_pagina }}{% endblock %}

{% block content %}
    <header style="text-align: center; margin-bottom: 30px;">
        <h1>ðŸ‘• {{ titolo_pagina }} ðŸ¥‡</h1>
        <p>Esplora le maglie condivise dalla nostra community di collezionisti.</p>
    </header>

    <div style="margin-bottom: 30px;">
        <form method="GET" action="{% url 'vetrina_pubblica' %}" role="search">
            <label for="search">Cerca nella Vetrina</label>
            <input 
                type="search" 
                name="q" 
                id="search"
                placeholder="Squadra, giocatore o stagione..." 
                value="{{ query|default:'' }}" 
            >
            <button type="submit" class="contrast">Cerca</button>
            
            {% if query %}
                <p style="margin-top: 10px; font-weight: bold;">
                    Risultati per: <mark>"{{ query }}"</mark>
                    <a href="{% url 'vetrina_pubblica' %}" style="margin-left: 10px; color: var(--pico-color-danger); text-decoration: none;">(Annulla)</a>
                </p>
            {% endif %}
        </form>
    </div>

    <div style="margin-bottom: 30px; text-align: center;">
        <form method="GET" action="{% url 'vetrina_pubblica' %}" id="sort-form" style="display: inline-block;">
            {% if query %}
                <input type="hidden" name="q" value="{{ query }}">
            {% endif %}
            
            <label for="sort-select" style="font-weight: bold;">Ordina per:</label>
            <select 
                name="sort" 
                id="sort-select" 
                onchange="this.form.submit()"
                style="padding: 8px;"
            >
                <option value="-anno_stagione" {% if sort_by == '-anno_stagione' %}selected{% endif %}>Anno (PiÃ¹ recente)</option>
                <option value="anno_stagione" {% if sort_by == 'anno_stagione' %}selected{% endif %}>Anno (Meno recente)</option>
                <option value="giocatore" {% if sort_by == 'giocatore' %}selected{% endif %}>Giocatore (A-Z)</option>
                <option value="-giocatore" {% if sort_by == '-giocatore' %}selected{% endif %}>Giocatore (Z-A)</option>
                <option value="squadra" {% if sort_by == 'squadra' %}selected{% endif %}>Squadra (A-Z)</option>
                <option value="-data_creazione" {% if sort_by == '-data_creazione' %}selected{% endif %}>Data Aggiunta (PiÃ¹ recente)</option>
            </select>
        </form>
    </div>

    <div class="grid">
        {% for maglia in maglie %}
            <article>
                {% if maglia.foto %}
                    <img src="{{ maglia.foto.url }}" alt="{{ maglia.giocatore }}" style="width: 100%; height: 250px; object-fit: cover; border-radius: 4px; margin-bottom: 10px;">
                {% else %}
                    <div style="width: 100%; height: 250px; background-color: var(--pico-muted-border-color); display: flex; align-items: center; justify-content: center; border-radius: 4px; margin-bottom: 10px;">
                        Nessuna Foto
                    </div>
                {% endif %}

                <hgroup>
                    <h3 style="margin-bottom: 0;">{{ maglia.squadra }}</h3>
                    <p>{{ maglia.giocatore }} ({{ maglia.anno_stagione }})</p>
                </hgroup>
                
                <p style="font-size: 0.9em; color: var(--pico-muted-color);">Collezionista: {{ maglia.utente.username }}</p>
                
                <footer>
                    <a 
                        href="{% url 'dettaglio_maglia' pk=maglia.pk %}" 
                        role="button"
                        class="contrast"
                    >
                        Visualizza Dettagli
                    </a>
                </footer>
            </article>
        {% empty %}
            <p>Al momento non ci sono maglie pubbliche in vetrina che corrispondono ai criteri.</p>
        {% endfor %}
    </div>

    {% if maglie.has_other_pages %}
        <nav aria-label="Pagination" style="margin-top: 40px; text-align: center;">
            <ul>
                {% if maglie.has_previous %}
                    <li>
                        <a 
                            href="?page={{ maglie.previous_page_number }}{% if query %}&q={{ query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}"
                            role="button"
                            class="secondary outline"
                        >
                            &laquo; Precedente
                        </a>
                    </li>
                {% endif %}
                
                <li>
                    <a href="#" aria-current="page" role="button" class="contrast">
                        Pagina {{ maglie.number }} di {{ maglie.paginator.num_pages }}
                    </a>
                </li>
                
                {% if maglie.has_next %}
                    <li>
                        <a 
                            href="?page={{ maglie.next_page_number }}{% if query %}&q={{ query }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}"
                            role="button"
                            class="secondary outline"
                        >
                            Successiva &raquo;
                        </a>
                    </li>
                {% endif %}
            </ul>
        </nav>
    {% endif %}
{% endblock %}